<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Untitled Cube Game</title>
<style>
  /* resets */
  body, html {
    margin: 0; padding: 0; overflow: hidden; background: #121212; color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
  #gameCanvas {
    display: block;
    background: linear-gradient(135deg, #1f1f1f, #2a2a2a);
    margin: 0 auto;
    touch-action: none;
    box-shadow: 0 0 20px #0af;
    border-radius: 10px;
  }
  #ui {
    position: absolute;
    top: 15px; left: 15px;
    font-size: 20px;
    background: rgba(20, 20, 30, 0.85);
    padding: 8px 14px;
    border-radius: 12px;
    box-shadow: 0 0 12px #08f7ffaa;
    user-select: none;
    display: flex;
    gap: 18px;
    font-weight: 600;
    letter-spacing: 0.05em;
    z-index: 10;
  }
  #ui span {
    user-select: text;
  }
  #deathOverlay.hit {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(255, 0, 0, 0.6);
    pointer-events: none;
    animation: flash 0.08s ease-out;
    z-index: 25;
  }
  @keyframes flash {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  /* menus */
  #mainMenu, #deathMenu, #storeScreen {
    position: fixed;
    top:0; left:0; width:100vw; height:100vh;
    background: linear-gradient(180deg, #0d0d0ddd, #111111ee);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #00e5ff;
    font-size: 26px;
    z-index: 20;
    text-shadow: 0 0 8px #00e5ff99;
    user-select: none;
  }
  #mainMenu h1, #deathMenu h2, #storeScreen h2 {
    margin-bottom: 30px;
    font-weight: 800;
    letter-spacing: 0.1em;
  }
  button {
    margin: 12px;
    padding: 14px 28px;
    font-size: 22px;
    cursor: pointer;
    background: #001f3f;
    border: 2px solid #00e5ff;
    color: #00e5ff;
    border-radius: 14px;
    transition: background 0.3s, color 0.3s;
    font-weight: 700;
    user-select: none;
    box-shadow: 0 0 15px #00e5ff77;
    min-width: 140px;
  }
  button:hover:not(:disabled) {
    background: #00e5ff;
    color: #001f3f;
    box-shadow: 0 0 25px #00e5ffcc;
  }
  button:disabled {
    opacity: 0.4;
    cursor: default;
    box-shadow: none;
  }
  #diffButtons {
    display: flex;
    gap: 20px;
  }
  #diffButtons button.selected {
    background: #00e5ff;
    color: #001f3f;
    box-shadow: 0 0 30px #00e5ffdd;
  }
  #storeScreen {
    overflow-y: auto;
    padding: 20px 10px 30px;
  }
  #coinsDisplay {
    font-size: 24px;
    margin-bottom: 15px;
    font-weight: 700;
    letter-spacing: 0.1em;
  }
  #itemsList {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 14px;
  }
  .itemCard {
    background: #001f3f;
    border: 2px solid #00b4d8;
    border-radius: 16px;
    padding: 14px 18px;
    width: 280px;
    box-shadow: 0 0 14px #0077b6bb;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #caf0f8;
    user-select: none;
  }
  .itemCard.owned {
    border-color: #00ff94;
    box-shadow: 0 0 20px #00ff9488;
  }
  .itemCard.selected {
    border-color: #90e0ef;
    box-shadow: 0 0 30px #90e0efcc;
  }
  .swatch {
    width: 50px; height: 50px;
    border-radius: 10px;
    margin-bottom: 10px;
    border: 2px solid #00e5ff;
  }
  .itemCard strong {
    font-size: 20px;
    margin-bottom: 6px;
    user-select: text;
  }
  .itemCard div {
    font-size: 14px;
    margin-bottom: 12px;
    color: #a0d8f8cc;
    text-align: center;
    user-select: text;
  }
  .itemCard button {
    min-width: 100px;
    font-weight: 700;
    box-shadow: 0 0 10px #00e5ffbb;
  }

  /* joystick */
  #joystickContainer {
    position: fixed;
    bottom: 60px;
    left: 50px;
    width: 70px;
    height: 70px;
    background: rgba(0, 229, 255, 0.15);
    border-radius: 50%;
    touch-action: none;
    z-index: 30;
    box-shadow: 0 0 14px #00e5ff77;
  }
  #joystickThumb {
    position: absolute;
    width: 34px;
    height: 34px;
    background: #00e5ffcc;
    border-radius: 50%;
    left: 35px;
    top: 35px;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 14px #00e5ffcc;
  }

  /* pause button */
  #pauseBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 15;
    display: none;
    background: #001f3f;
    border: 2px solid #00e5ff;
    color: #00e5ff;
    border-radius: 14px;
    padding: 10px 22px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 0 15px #00e5ffaa;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  #pauseBtn:hover {
    background: #00e5ff;
    color: #001f3f;
    box-shadow: 0 0 25px #00e5ffdd;
  }

  /* fade in */
  .fade-in {
    animation: fadeInAnim 0.3s ease forwards;
  }
  @keyframes fadeInAnim {
    from {opacity: 0;}
    to {opacity: 1;}
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui" style="display:none;">
  <span>‚ù§Ô∏è health: <span id="health">0</span></span>
  <span>‚≠ê score: <span id="score">0</span></span>
  <span>ü™ô coins: <span id="coins">0</span></span>
  <span>üéö difficulty: <span id="difficultyText"></span></span>
</div>

<div id="deathOverlay"></div>

<div id="mainMenu">
  <h1>Untitled Cube Game</h1>
  <div id="diffButtons">
    <button data-difficulty="easy">Easy</button>
    <button data-difficulty="medium">Medium</button>
    <button data-difficulty="hard">Hard</button>
  </div>
  <button id="playBtn" disabled>Play</button>
  <button id="openStoreBtn">Store</button>
</div>

<div id="deathMenu" style="display:none; flex-direction: column; align-items: center; justify-content: center;">
  <h2>Game Over</h2>
  <div id="finalScore" style="margin: 10px 0; font-weight: 700; font-size: 22px;">score: 0</div>
  <div id="finalCoins" style="margin: 10px 0; font-weight: 700; font-size: 22px;">coins earned: 0</div>
  <button id="restartBtn">Restart</button>
  <button id="mainMenuBtn">Main Menu</button>
</div>

<div id="storeScreen">
  <h2>Store</h2>
  <div id="coinsDisplay">coins: 0</div>
  <div id="itemsList"></div>
  <button id="closeStore">Back</button>
</div>

<div id="joystickContainer" style="display:none;">
  <div id="joystickThumb"></div>
</div>

<button id="pauseBtn">pause</button>

<script>
(() => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  let W, H;
  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }
  window.addEventListener("resize", resize);
  resize();

  // DOM elements
  const ui = document.getElementById("ui");
  const healthSpan = document.getElementById("health");
  const scoreSpan = document.getElementById("score");
  const coinsSpan = document.getElementById("coins");
  const difficultyText = document.getElementById("difficultyText");

  const deathOverlay = document.getElementById("deathOverlay");
  const mainMenu = document.getElementById("mainMenu");
  const deathMenu = document.getElementById("deathMenu");
  const finalScore = document.getElementById("finalScore");
  const finalCoins = document.getElementById("finalCoins");

  const playBtn = document.getElementById("playBtn");
  const restartBtn = document.getElementById("restartBtn");
  const mainMenuBtn = document.getElementById("mainMenuBtn");

  const storeScreen = document.getElementById("storeScreen");
  const openStoreBtn = document.getElementById("openStoreBtn");
  const closeStore = document.getElementById("closeStore");
  const coinsDisplay = document.getElementById("coinsDisplay");
  const itemsList = document.getElementById("itemsList");

  const pauseBtn = document.getElementById("pauseBtn");

  // joystick
  const joystickContainer = document.getElementById("joystickContainer");
  const joystickThumb = document.getElementById("joystickThumb");

  // keys
  const keys = {};

  // constants for localstorage keys
  const KEY_COINS = "ucg_coins";
  const KEY_OWNED = "ucg_ownedSkins";
  const KEY_SELECTED = "ucg_selectedSkin";
  const KEY_POWERUPS = "ucg_powerups";
  const KEY_DIFF = "ucg_difficulty";

  // game state
  let coins = 0;
  let difficulty = "easy";

  // player
  const player = {
    x: 0,
    y: 0,
    size: 30,
    speed: 5,
    health: 50,
    maxHealth: 50,
  };

  // enemies and particles
  let enemies = [];
  let particles = [];
  let fragments = [];

  const MAX_PARTICLES = 70;

  let running = false;
  let paused = false;

  let lastTime = 0;
  let scaleTimer = 0;

  let lastScoreTick = 0;
  let score = 0;

  // skins and powerups
  const skins = [
    { id: "green", name: "green", price: 0, color: "#0f0", desc: "classic green" },
    { id: "red", name: "red", price: 300, color: "#f00", desc: "fiery cube" },
    { id: "blue", name: "blue", price: 500, color: "#06f", desc: "cool blue" },
  ];

  const powerups = [
    { id: "hpUp", name: "extra health", price: 800, desc: "adds +20 max health" },
    { id: "coinBoost", name: "coin boost", price: 1200, desc: "coins x2" },
  ];

  // user owned stuff
  let ownedSkins = JSON.parse(localStorage.getItem(KEY_OWNED)) || ["green"];
  let selectedSkin = localStorage.getItem(KEY_SELECTED) || "green";
  let ownedPowerups = JSON.parse(localStorage.getItem(KEY_POWERUPS)) || [];

  // difficulty settings
  const difficulties = {
    easy: { spawn: 2500, enemySpeed: 1.5, scorePerSec: 1, healthMult: 1, coinMult: 1 },
    medium: { spawn: 1800, enemySpeed: 2.6, scorePerSec: 2, healthMult: 0.85, coinMult: 1.3 },
    hard: { spawn: 600, enemySpeed: 6.5, scorePerSec: 6, healthMult: 0.4, coinMult: 2.5 },
  };

  // joystick state
  let joystickActive = false;
  let joystickOrigin = { x: 0, y: 0 };
  let joystickPos = { x: 0, y: 0 };

  // limit max hits to 5 before death
  const MAX_HITS = 5;

  // helper funcs
  function clamp(val, min, max) {
    return val < min ? min : val > max ? max : val;
  }
  function rectsCollide(r1, r2) {
    return (
      r1.x < r2.x + r2.size &&
      r1.x + r1.size > r2.x &&
      r1.y < r2.y + r2.size &&
      r1.y + r1.size > r2.y
    );
  }
  function saveGame() {
    localStorage.setItem(KEY_COINS, coins);
    localStorage.setItem(KEY_OWNED, JSON.stringify(ownedSkins));
    localStorage.setItem(KEY_SELECTED, selectedSkin);
    localStorage.setItem(KEY_POWERUPS, JSON.stringify(ownedPowerups));
    localStorage.setItem(KEY_DIFF, difficulty);
  }
  function loadGame() {
    coins = Number(localStorage.getItem(KEY_COINS)) || 0;
    ownedSkins = JSON.parse(localStorage.getItem(KEY_OWNED)) || ["green"];
    selectedSkin = localStorage.getItem(KEY_SELECTED) || "green";
    ownedPowerups = JSON.parse(localStorage.getItem(KEY_POWERUPS)) || [];
    difficulty = localStorage.getItem(KEY_DIFF) || "easy";
  }
  function pickSkinColor(id) {
    let s = skins.find((sk) => sk.id === id);
    return s ? s.color : "#0f0";
  }
  function hasPowerup(id) {
    return ownedPowerups.includes(id);
  }

  // apply powerup bonuses
  function maxPlayerHealth() {
    let base = 50;
    if (hasPowerup("hpUp")) base += 20;
    return base;
  }
  function coinMultiplier() {
    return hasPowerup("coinBoost") ? 2 : 1;
  }

  // enemies spawn top-down, move downward
  function spawnEnemy() {
    enemies.push({
      x: Math.random() * (W - 30),
      y: -40,
      size: 28 + Math.random() * 10,
      speed: difficulties[difficulty].enemySpeed,
      color: "#f00",
    });
  }

  // particles float left with 50% transparency
  function spawnParticle() {
    if (particles.length >= MAX_PARTICLES) return;
    particles.push({
      x: Math.random() * W,
      y: Math.random() * H,
      size: 3 + Math.random() * 3,
      speedX: -0.25 - Math.random() * 0.25,
      alpha: 0.5,
    });
  }

  // create death fragments for player (just the player)
  function createFragments() {
    fragments = [];
    const fragCount = 14;
    for (let i = 0; i < fragCount; i++) {
      fragments.push({
        x: player.x + player.size / 2,
        y: player.y + player.size / 2,
        size: 6 + Math.random() * 4,
        vx: (Math.random() - 0.5) * 6,
        vy: (Math.random() - 0.5) * 6,
        life: 60 + Math.random() * 20,
        alpha: 1,
        color: pickSkinColor(selectedSkin),
      });
    }
  }

  // draw fragments
  function drawFragments() {
    for (let f of fragments) {
      const r = parseInt(f.color.slice(1, 3), 16);
      const g = parseInt(f.color.slice(3, 5), 16);
      const b = parseInt(f.color.slice(5, 7), 16);
      ctx.fillStyle = `rgba(${r},${g},${b},${f.alpha.toFixed(2)})`;
      ctx.fillRect(f.x, f.y, f.size, f.size);
    }
  }

  // update fragments physics
  function updateFragments() {
    for (let f of fragments) {
      f.x += f.vx;
      f.y += f.vy;
      f.vx *= 0.92;
      f.vy += 0.25; // gravity
      f.life--;
      f.alpha = f.life / 80;
    }
    fragments = fragments.filter((f) => f.life > 0);
  }

  // joystick controls for mobile
  function initJoystick() {
    joystickContainer.style.display = "block";
    let active = false;
    let origin = { x: 0, y: 0 };

    function onStart(e) {
      active = true;
      const touch = e.targetTouches ? e.targetTouches[0] : e;
      origin.x = touch.clientX;
      origin.y = touch.clientY;
      joystickThumb.style.left = origin.x + "px";
      joystickThumb.style.top = origin.y + "px";
      joystickContainer.style.left = origin.x - 35 + "px";
      joystickContainer.style.top = origin.y - 35 + "px";
      joystickPos.x = 0;
      joystickPos.y = 0;
      e.preventDefault();
    }
    function onMove(e) {
      if (!active) return;
      const touch = e.targetTouches ? e.targetTouches[0] : e;
      let dx = touch.clientX - origin.x;
      let dy = touch.clientY - origin.y;
      let dist = Math.sqrt(dx * dx + dy * dy);
      let maxDist = 35;
      if (dist > maxDist) {
        dx = (dx / dist) * maxDist;
        dy = (dy / dist) * maxDist;
      }
      joystickPos.x = dx / maxDist;
      joystickPos.y = dy / maxDist;
      joystickThumb.style.left = origin.x + dx + "px";
      joystickThumb.style.top = origin.y + dy + "px";
      e.preventDefault();
    }
    function onEnd(e) {
      active = false;
      joystickPos.x = 0;
      joystickPos.y = 0;
      joystickThumb.style.left = origin.x + "px";
      joystickThumb.style.top = origin.y + "px";
      e.preventDefault();
    }
    joystickContainer.addEventListener("touchstart", onStart);
    joystickContainer.addEventListener("touchmove", onMove);
    joystickContainer.addEventListener("touchend", onEnd);
    joystickContainer.addEventListener("touchcancel", onEnd);
  }

  // input handlers
  window.addEventListener("keydown", (e) => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener("keyup", (e) => {
    keys[e.key.toLowerCase()] = false;
  });

  // game variables
  let spawnTimer = 0;
  let hitsTaken = 0;

  // game loop
  function gameLoop(time = 0) {
    if (!running || paused) {
      lastTime = time;
      requestAnimationFrame(gameLoop);
      return;
    }

    const delta = (time - lastTime) / 1000;
    lastTime = time;

    // clear
    ctx.clearRect(0, 0, W, H);

    // spawn enemies
    spawnTimer += delta * 1000;
    if (spawnTimer > difficulties[difficulty].spawn) {
      spawnEnemy();
      spawnTimer = 0;
    }

    // spawn particles
    if (particles.length < MAX_PARTICLES) {
      spawnParticle();
    }

    // update particles
    for (let p of particles) {
      p.x += p.speedX;
      if (p.x < -10) p.x = W + 10;
      ctx.fillStyle = `rgba(255,255,255,${p.alpha})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size / 2, 0, Math.PI * 2);
      ctx.fill();
    }

    // move player
    let moveX = 0, moveY = 0;
    if (joystickPos.x !== 0 || joystickPos.y !== 0) {
      moveX = joystickPos.x * player.speed;
      moveY = joystickPos.y * player.speed;
    } else {
      if (keys["a"] || keys["arrowleft"]) moveX -= player.speed;
      if (keys["d"] || keys["arrowright"]) moveX += player.speed;
      if (keys["w"] || keys["arrowup"]) moveY -= player.speed;
      if (keys["s"] || keys["arrowdown"]) moveY += player.speed;
    }

    player.x += moveX;
    player.y += moveY;
    // clamp player to screen
    player.x = clamp(player.x, 0, W - player.size);
    player.y = clamp(player.y, 0, H - player.size);

    // draw player
    ctx.fillStyle = pickSkinColor(selectedSkin);
    ctx.fillRect(player.x, player.y, player.size, player.size);

    // update enemies
    for (let i = enemies.length - 1; i >= 0; i--) {
      let e = enemies[i];
      e.y += e.speed;
      ctx.fillStyle = e.color;
      ctx.fillRect(e.x, e.y, e.size, e.size);

      // check collision with player
      if (rectsCollide(player, e)) {
        enemies.splice(i, 1);
        hitsTaken++;
        showHitEffect();
        if (hitsTaken >= MAX_HITS) {
          // player dead
          running = false;
          createFragments();
          deathOverlay.classList.add("hit");
          setTimeout(() => {
            deathOverlay.classList.remove("hit");
            showDeathMenu();
          }, 300);
        }
      } else if (e.y > H) {
        enemies.splice(i, 1);
      }
    }

    // update and draw fragments (death effect)
    if (fragments.length > 0) {
      updateFragments();
      drawFragments();
    }

    // update score every second based on difficulty multiplier
    if (time - lastScoreTick > 1000) {
      score += difficulties[difficulty].scorePerSec;
      lastScoreTick = time;
      // convert score to coins, 10 score = 1 coin * coin multiplier * difficulty coinMult
      const coinsEarned = Math.floor(score / 10) - Math.floor((score - difficulties[difficulty].scorePerSec) / 10);
      coins += coinsEarned * coinMultiplier() * difficulties[difficulty].coinMult;
    }

    // update UI
    healthSpan.textContent = Math.max(0, player.maxHealth * difficulties[difficulty].healthMult - (hitsTaken * (player.maxHealth * difficulties[difficulty].healthMult / MAX_HITS))).toFixed(0);
    scoreSpan.textContent = score.toFixed(0);
    coinsSpan.textContent = coins.toFixed(0);
    difficultyText.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);

    requestAnimationFrame(gameLoop);
  }

  // show hit flash effect
  function showHitEffect() {
    deathOverlay.classList.add("hit");
    setTimeout(() => {
      deathOverlay.classList.remove("hit");
    }, 80);
  }

  // show death menu
  function showDeathMenu() {
    ui.style.display = "none";
    deathMenu.style.display = "flex";
    finalScore.textContent = `score: ${score.toFixed(0)}`;
    const earnedCoins = Math.floor(score / 10) * coinMultiplier() * difficulties[difficulty].coinMult;
    finalCoins.textContent = `coins earned: ${earnedCoins.toFixed(0)}`;
    coins += earnedCoins;
    saveGame();
  }

  // reset game variables for new game
  function resetGame() {
    hitsTaken = 0;
    score = 0;
    enemies = [];
    particles = [];
    fragments = [];
    player.maxHealth = maxPlayerHealth();
    player.health = player.maxHealth;
    spawnTimer = 0;
    lastScoreTick = 0;
    running = true;
    paused = false;
    ui.style.display = "flex";
    pauseBtn.style.display = "block";
  }

  // difficulty button handling
  const diffButtons = document.querySelectorAll("#diffButtons button");
  diffButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      difficulty = btn.dataset.difficulty;
      saveGame();
      updateDiffButtons();
      playBtn.disabled = false;
      difficultyText.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
    });
  });
  function updateDiffButtons() {
    diffButtons.forEach(btn => {
      btn.classList.toggle("selected", btn.dataset.difficulty === difficulty);
    });
  }

  // play button click
  playBtn.addEventListener("click", () => {
    mainMenu.style.display = "none";
    deathMenu.style.display = "none";
    storeScreen.style.display = "none";
    resetGame();
    requestAnimationFrame(gameLoop);
  });

  // restart button
  restartBtn.addEventListener("click", () => {
    deathMenu.style.display = "none";
    resetGame();
    requestAnimationFrame(gameLoop);
  });

  // main menu button from death screen
  mainMenuBtn.addEventListener("click", () => {
    deathMenu.style.display = "none";
    mainMenu.style.display = "flex";
    ui.style.display = "none";
    pauseBtn.style.display = "none";
  });

  // pause button toggle
  pauseBtn.addEventListener("click", () => {
    paused = !paused;
    pauseBtn.textContent = paused ? "resume" : "pause";
  });

  // store logic (simplified for brevity)
  function updateStoreUI() {
    coinsDisplay.textContent = `coins: ${coins.toFixed(0)}`;
  }
  function renderStoreItems() {
    itemsList.innerHTML = "";
    // skins
    skins.forEach(skin => {
      const item = document.createElement("div");
      item.className = "itemCard";
      if (ownedSkins.includes(skin.id)) item.classList.add("owned");
      if (selectedSkin === skin.id) item.classList.add("selected");
      const swatch = document.createElement("div");
      swatch.className = "swatch";
      swatch.style.backgroundColor = skin.color;
      const title = document.createElement("strong");
      title.textContent = skin.name;
      const desc = document.createElement("div");
      desc.textContent = skin.desc;
      const price = document.createElement("div");
      price.textContent = ownedSkins.includes(skin.id) ? "Owned" : `Price: ${skin.price} coins`;
      const btn = document.createElement("button");
      btn.textContent = ownedSkins.includes(skin.id) ? (selectedSkin === skin.id ? "Selected" : "Select") : "Buy";
      btn.disabled = selectedSkin === skin.id && ownedSkins.includes(skin.id);

      btn.onclick = () => {
        if (ownedSkins.includes(skin.id)) {
          if (selectedSkin !== skin.id) {
            selectedSkin = skin.id;
            saveGame();
            updateStoreUI();
            renderStoreItems();
          }
        } else {
          if (coins >= skin.price) {
            coins -= skin.price;
            ownedSkins.push(skin.id);
            selectedSkin = skin.id;
            saveGame();
            updateStoreUI();
            renderStoreItems();
          } else {
            alert("Not enough coins!");
          }
        }
      };

      item.appendChild(swatch);
      item.appendChild(title);
      item.appendChild(desc);
      item.appendChild(price);
      item.appendChild(btn);
      itemsList.appendChild(item);
    });
    // powerups
    powerups.forEach(pwr => {
      const item = document.createElement("div");
      item.className = "itemCard";
      if (ownedPowerups.includes(pwr.id)) item.classList.add("owned");
      const title = document.createElement("strong");
      title.textContent = pwr.name;
      const desc = document.createElement("div");
      desc.textContent = pwr.desc;
      const price = document.createElement("div");
      price.textContent = ownedPowerups.includes(pwr.id) ? "Owned" : `Price: ${pwr.price} coins`;
      const btn = document.createElement("button");
      btn.textContent = ownedPowerups.includes(pwr.id) ? "Owned" : "Buy";
      btn.disabled = ownedPowerups.includes(pwr.id);

      btn.onclick = () => {
        if (!ownedPowerups.includes(pwr.id)) {
          if (coins >= pwr.price) {
            coins -= pwr.price;
            ownedPowerups.push(pwr.id);
            saveGame();
            updateStoreUI();
            renderStoreItems();
          } else {
            alert("Not enough coins!");
          }
        }
      };

      item.appendChild(title);
      item.appendChild(desc);
      item.appendChild(price);
      item.appendChild(btn);
      itemsList.appendChild(item);
    });
  }

  openStoreBtn.addEventListener("click", () => {
    mainMenu.style.display = "none";
    storeScreen.style.display = "flex";
    updateStoreUI();
    renderStoreItems();
  });

  closeStore.addEventListener("click", () => {
    storeScreen.style.display = "none";
    mainMenu.style.display = "flex";
  });

  // start on main menu
  ui.style.display = "none";
  pauseBtn.style.display = "none";

  // load saved data
  loadGame();
  updateDiffButtons();
  playBtn.disabled = false;
  difficultyText.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);

  // move player initial position
  player.x = W / 2 - player.size / 2;
  player.y = H - player.size * 3;

  // detect mobile and init joystick
  function isMobile() {
    return /Mobi|Android/i.test(navigator.userAgent);
  }
  if (isMobile()) {
    initJoystick();
  } else {
    joystickContainer.style.display = "none";
  }

})();
</script>

</body>
</html>
